var GFChart={},gfchart_admin_chart_config=function(r){var c=!1;r(window).load(function(){var a,t,i;(a=r('input[name="gfchart_config[chart_type]"]:checked').val())&&(r("#gfchart-chart-type-"+a+"-basic-settings").show(),r("#gfchart-"+a+"-select-data").show(),r("#gfchart-"+a+"-customiser").show(),r("#gfchart_"+a+"_entry_filters").removeClass("hide-if-js").gfFilterUI(gfchart_admin_config.gformFieldFilters,gfchart_admin_config.gformInitFilter,!0),h(a)),r('input[name="gfchart_config[chart_type]"]').on("click",e),r(".gfchart-config-tab-nav-button").on("click",n),r("#post").on("change",s),r(document).on("gfchart_config_switch_tab",g),r(document).on("gfchart_config_switch_tab",v),r(".gfchart-config-tab-nav-button-save").on("click",f),r("#gfchart-bar-xaxis-segment-toggle-on").on("click",{toggle:"on"},d),r("#gfchart-bar-xaxis-segment-toggle-off").on("click",{toggle:"off"},d),r("#gfchart-bar-yaxis").on("change",l),r("#gfchart-bar-yaxis-auto").on("click",_),r('input[name="gfchart_config[date_filter_start]"], input[name="gfchart_config[date_filter_end]"]').datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,constrainInput:!1}),t='[gfchart id="'+r("#post_ID").val()+'"]',i=r('<input type="text">').addClass("gfchart_shortcode").val(t).attr("readonly","readonly").on("focus click",function(){r(this).select()}),r(".post-type-gfchart #postbox-container-1 #misc-publishing-actions").prepend(r('<div class="misc-pub-section misc-pub-gfchart-shortcode">'+gfchart_admin_config.publish_text+"</div>").append(i)).show()});var t={};function e(){var a=jQuery(this).val();r('input[name="gfchart_config[additional_filters]"]').prop("checked",!1),r("#gform-field-filters").detach(),gfchart_admin_config.gformInitFilter.filters.length=0,gfchart_admin_config.gformInitFilter.mode="",function(){void 0===gfchart_js.basic_settings&&(gfchart_js.basic_settings={});void 0===gfchart_js.select_data&&(gfchart_js.select_data={});void 0===gfchart_js.customiser&&(gfchart_js.customiser={});gfchart_admin_config.chart_types.forEach(function(a){var t=r("#gfchart-chart-type-"+a+"-basic-settings");0!==t.length&&(gfchart_js.basic_settings[a]=t.hide(),t.detach());var i=r("#gfchart-"+a+"-select-data");0!==i.length&&(gfchart_js.select_data[a]=i.hide(),i.detach());var c=r("#gfchart-"+a+"-customiser");0!==c.length&&(gfchart_js.customiser[a]=c.hide(),c.detach())})}(),r(".gfchart-config-tab-nav-button-save").trigger("click"),r("#gfchart-config-section-design").append(gfchart_js.basic_settings[a]),r("#gfchart-chart-type-"+a+"-basic-settings").show(),r("#gfchart-config-section-select-data").append(gfchart_js.select_data[a]),r("#gfchart-"+a+"-select-data").show(),r("#gfchart-config-section-customiser").append(gfchart_js.customiser[a]),r("#gfchart-"+a+"-customiser").show();var t=r("#gfchart_"+a+"_entry_filters");t.hide(),t.removeClass("hide-if-js").gfFilterUI(gfchart_admin_config.gformFieldFilters,gfchart_admin_config.gformInitFilter,!0),h(a)}function n(a){a.preventDefault();var t,i,c,e=r(this),n=e.data("gfconfigTab");"customiser"==n&&e.hasClass("gfchart-config-tab-nav-button-prev")?o(n):(t=e.parents(".gfchart-config-section"),(i=t.find(".gfchart-config-tab-nav-button-save")).hide(),e.hide(),e.after('<span id="gfchart-config-tab-loading-msg"><img src="'+gfchart_admin_config.loading_img+'" /> Saving...</span>'),e.hasClass("gfchart-config-tab-nav-button-next")?0!==(c=t.find(".gfchart-config-tab-nav-button-prev")).length&&c.hide():e.hasClass("gfchart-config-tab-nav-button-prev")&&0!==(c=t.find(".gfchart-config-tab-nav-button-next")).length&&c.hide(),r.post(ajaxurl,{data:r("#post").serialize(),action:"gf_dynamically_save_chart_config"}).done(function(a){!0===a.success&&o(n),r("#gfchart-config-tab-loading-msg").remove(),e.show(),i.show(),c.show()}).fail(function(a){window.console&&window.console.log&&console.log(a)}).always())}function o(i){var c=r("#gfchart-config-tab-"+i),a=r("#gfchart-view-configuration-tabs").children(".nav-tab-wrapper"),e=null;a.children().each(function(){var a,t;c.hasClass("nav-tab-active")||((a=r(".nav-tab-active")).removeClass("nav-tab-active"),c.addClass("nav-tab-active"),e=c.index(),r("#gfchart-view-configuration-tabs").children("div:not( .inside.hidden )").addClass("hidden"),r("#gfchart-view-configuration-tabs").children("div:nth-child("+e+")").addClass("hidden"),r("#gfchart-view-configuration-tabs").children("div:nth-child( "+(e+2)+")").removeClass("hidden"),t=a.prop("href").replace("#",""),r(document).trigger("gfchart_config_switch_tab",[i,t]))})}function s(){c=!0}function g(a,t,i){t!==i&&c&&(r("#"+t).find(".gfchart-config-tab-nav-button-save").trigger("click"),c=!1)}function f(){var t=r(this),i=t.val();t.prop("disabled",!0);var a=r(this).parents(".gfchart-config-section"),c=a.find(".gfchart-config-tab-nav-button-prev");0!==c.length&&c.hide();var e=a.find(".gfchart-config-tab-nav-button-next");0!==e.length&&e.hide(),t.val("Saving..."),r.post(ajaxurl,{data:r("#post").serialize(),action:"gf_dynamically_save_chart_config"}).done(function(a){!0===a.success?(t.val("Saved!"),setTimeout(function(){t.val(i),t.prop("disabled",!1),c.show(),e.show()},2e3)):(t.before(a.data),t.val(i),t.prop("disabled",!1),c.show(),e.show())}).fail(function(a){window.console&&window.console.log&&console.log(a)}).always()}function h(a){switch(a){case"pie":r("#gfchart-pie-additional-filters").click({chart_type:"pie"},t.gfchart_toggle_filters);break;case"bar":""!==r("#gfchart-bar-xaxis-segment-field").val()&&(r("#gfchart-bar-xaxis-segment-container").show("slow"),r("#gfchart-bar-xaxis-segment-toggle-on").hide(),r("#gfchart-bar-xaxis-segment-toggle-off").show()),r("#gfchart-bar-additional-filters").click({chart_type:"bar"},t.gfchart_toggle_filters),r("#gfchart-bar-yaxis-auto").is(":checked")&&(r("#gfchart-bar-chart-yaxis-max-container").hide("slow"),r("#gfchart-bar-chart-yaxis-lines-container").hide("slow")),"sum"===r("#gfchart-bar-yaxis").val()&&r("#gfchart-bar-xaxis-sum-field-container").show();break;case"calc":r("#gfchart-calc-additional-filters").click({chart_type:"calc"},t.gfchart_toggle_filters)}gfchart.doAction("gfchart_select_data_init",a)}function l(){"sum"==r(this).val()?r("#gfchart-bar-xaxis-sum-field-container").show("slow"):(r("#gfchart-bar-xaxis-sum-field-container").hide("slow"),r("#gfchart-bar-xaxis-sum-field").val(""))}function d(a){a.preventDefault(),"on"==a.data.toggle?(r("#gfchart-bar-xaxis-segment-container").show("slow"),r("#gfchart-bar-xaxis-segment-toggle-on").hide(),r("#gfchart-bar-xaxis-segment-toggle-off").show()):(r("#gfchart-bar-xaxis-segment-container").hide("slow"),r("#gfchart-bar-xaxis-segment-field").val(""),r("#gfchart-bar-xaxis-segment-display").val([]),r("#gfchart-bar-xaxis-segment-max-entries").val(""),r("#gfchart-bar-xaxis-segment-toggle-off").hide(),r("#gfchart-bar-xaxis-segment-toggle-on").show())}function _(){r(this).is(":checked")?(r("#gfchart-bar-chart-yaxis-max-container").hide("slow"),r("#gfchart-bar-chart-yaxis-lines-container").hide("slow"),r('input[name="gfchart_config[yaxis-max]"]').val(""),r('input[name="gfchart_config[yaxis-lines]"]').val("")):(r("#gfchart-bar-chart-yaxis-max-container").show("slow"),r("#gfchart-bar-chart-yaxis-lines-container").show("slow"))}function v(a,t,i){if("preview"==t){var c=r('input[name="gfchart_config[chart_type]"]:checked').val(),e=r("#gfchart-config-section-preview");if(e.html('<img src="'+gfchart_admin_config.loading_img+'" /> Generating preview...'),r("#"+t).find(".gfchart-config-tab-nav-button-save").prop("disabled"))return void setTimeout(function(){v(a,t,i)},1e3);var n=r("#post_ID").val();r.post(ajaxurl,{post:n,action:"gf_get_preview_chart_data",gfchart_config_nonce:r("#gfchart_config_nonce").val()}).done(function(a){var t,i;!0===a.success?("calc"===c&&(a.data.chart_data[0]="<span style='font-weight:bold;font-size:x-large;'>"+a.data.chart_data[0]+"</span>"),t=a.data.chart_data,i=c.charAt(0).toUpperCase()+c.slice(1),gfchart_draw(i,n,t,a.data.chart_options,"gfchart-config-section-preview",0)):(e.html(a.data),e.show())}).fail(function(a){window.console&&window.console.log&&console.log(a)}).always()}}return t.gfchart_toggle_filters=function(a){var t;r(this).is(":checked")?r("#gfchart_"+a.data.chart_type+"_entry_filters").show("slow"):((t=r("#gfchart_"+a.data.chart_type+"_entry_filters")).hide("slow"),t.find(".gform-remove").each(function(){r(this).trigger("click")}))},t}(jQuery);