var GFChartShortcodeUI;!function(e,t){var o=window.GFChartShortcodeUI={models:{},collections:{},views:{},utils:{},error_messages:{}};o.models.ShortcodeAttribute=Backbone.Model.extend({defaults:{attr:"",label:"",type:"",section:"",description:"","default":"",value:""}}),o.models.ShortcodeAttributes=Backbone.Collection.extend({model:o.models.ShortcodeAttribute,clone:function(){return new this.constructor(_.map(this.models,function(e){return e.clone()}))}}),o.models.Shortcode=Backbone.Model.extend({defaults:{label:"",shortcode_tag:"",action_tag:"",attrs:o.models.ShortcodeAttributes},set:function(e,t){return void 0===e.attrs||e.attrs instanceof o.models.ShortcodeAttributes||(_.each(e.attrs,function(e){void 0!=e.default&&(e.value=e.default)}),e.attrs=new o.models.ShortcodeAttributes(e.attrs)),Backbone.Model.prototype.set.call(this,e,t)},toJSON:function(e){return e=Backbone.Model.prototype.toJSON.call(this,e),void 0!==e.attrs&&e.attrs instanceof o.models.ShortcodeAttributes&&(e.attrs=e.attrs.toJSON()),e},clone:function(){var e=Backbone.Model.prototype.clone.call(this);return e.set("attrs",e.get("attrs").clone()),e},formatShortcode:function(){var e,t,o=[];return this.get("attrs").each(function(e){var r=e.get("value"),a=e.get("type"),i=e.get("default");(!r||r.length<1)&&"checkbox"!=a||"checkbox"==a&&"true"!=i&&!r||("content"===e.get("attr")?t=e.get("value"):o.push(e.get("attr")+'="'+r+'"'))}),e="[{{ shortcode }} {{ attributes }}]",t&&t.length>0&&(e+="{{ content }}[/{{ shortcode }}]"),e=e.replace(/{{ shortcode }}/g,this.get("shortcode_tag")),e=e.replace(/{{ attributes }}/g,o.join(" ")),e=e.replace(/{{ content }}/g,t)},validate:function(e){var t=[],r=e.attrs.findWhere({attr:"id"});return r.get("value")||t.push({id:o.error_messages.no_chart_selected}),t.length?t:null}}),o.collections.Shortcodes=Backbone.Collection.extend({model:o.models.Shortcode}),o.views.editShortcodeForm=wp.Backbone.View.extend({el:"#gfchart-shortcode-ui-container",template:wp.template("gfchart-shortcode-default-edit-form"),hasAdvancedValue:!1,events:{"click #gfchart-update-shortcode":"insertShortcode","click #gfchart-insert-shortcode":"insertShortcode","click #gfchart-cancel-shortcode":"cancelShortcode"},initialize:function(){_.bindAll(this,"beforeRender","render","afterRender");var e=this;this.render=_.wrap(this.render,function(t){return e.beforeRender(),t(),e.afterRender(),e}),this.model.get("attrs").each(function(t){switch(t.get("section")){case"required":e.views.add(".gfchart-edit-shortcode-form-required-attrs",new o.views.editAttributeField({model:t,parent:e}));break;case"standard":e.views.add(".gfchart-edit-shortcode-form-standard-attrs",new o.views.editAttributeField({model:t,parent:e}));break;default:e.views.add(".gfchart-edit-shortcode-form-advanced-attrs",new o.views.editAttributeField({model:t,parent:e})),e.hasAdvancedVal||(e.hasAdvancedVal=""!==t.get("value"))}}),this.listenTo(this.model,"change",this.render)},beforeRender:function(){},afterRender:function(){gform_initialize_tooltips(),t("#gfchart-insert-shortcode").toggle("insert"==this.options.viewMode),t("#gfchart-update-shortcode").toggle("insert"!=this.options.viewMode)},insertShortcode:function(){var e=this.model.isValid({validate:!0});e?(send_to_editor(this.model.formatShortcode()),tb_remove(),this.dispose()):_.each(this.model.validationError,function(e){_.each(e,function(e){alert(e)})})},cancelShortcode:function(){tb_remove(),this.dispose()},dispose:function(){this.remove(),t("#gfchart-shortcode-ui-wrap").append('<div id="gfchart-shortcode-ui-container"></div>')}}),o.views.editAttributeField=Backbone.View.extend({tagName:"div",initialize:function(e){this.parent=e.parent},events:{'keyup  input[type="text"]':"updateValue","keyup  textarea":"updateValue","change select":"updateValue","change #gfchart-shortcode-attr-action":"updateAction","change input[type=checkbox]":"updateCheckbox","change input[type=radio]":"updateValue","change input[type=email]":"updateValue","change input[type=number]":"updateValue","change input[type=date]":"updateValue","change input[type=url]":"updateValue"},render:function(){return this.template=wp.media.template("gfchart-shortcode-ui-field-"+this.model.get("type")),this.$el.html(this.template(this.model.toJSON()))},updateValue:function(e){var o=t(e.target);this.model.set("value",o.val())},updateCheckbox:function(e){var o=t(e.target),r=o.prop("checked");this.model.set("value",r)},updateAction:function(e){var r=t(e.target),a=r.val();this.model.set("value",a);var i=this.parent.model,d=o.shortcodes.findWhere({shortcode_tag:"gravityform",action_tag:a}),n=i.get("attrs");d.get("attrs").each(function(e){var t=e.get("attr"),o=n.findWhere({attr:t});if("undefined"!=typeof o){var r=o.get("attr");if(t==r){var a=o.get("value");e.set("value",String(a))}}}),t(this.parent.el).empty();var c=this.parent.options.viewMode;this.parent.dispose(),this.parent.model.set(d),GFChartShortcodeUI=new o.views.editShortcodeForm({model:d,viewMode:c}),GFChartShortcodeUI.render()}}),t(document).ready(function(){o.error_messages=gfchart_shortcode_ui.error_messages,o.shortcodes=new o.collections.Shortcodes(gfchart_shortcode_ui.shortcodes),t(document).on("click",".gfchart_media_link",function(){o.shortcodes=new o.collections.Shortcodes(gfchart_shortcode_ui.shortcodes);var e=o.shortcodes.findWhere({shortcode_tag:"gfchart",action_tag:""});GFChartShortcodeUI=new o.views.editShortcodeForm({model:e,viewMode:"insert"}),GFChartShortcodeUI.render(),tb_show("Insert Chart/Calculation","#TB_inline?inlineId=select_gravity_chart&width=500&height=400","")})})}(window.gfcShortcodeUI=window.gfcShortcodeUI||{},jQuery);